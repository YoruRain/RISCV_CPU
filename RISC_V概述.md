# RISC-V架构概述

在开发时需要围绕RISC-V架构的特点进行实现，因此罗列一些RISC-V重要的设计特点与理念。

### 模块化的指令子集

- 使用模块化的方式进行组织，每一个模块使用一个英文字母来表示

| 扩展指令集 | 指令数 | 描述                                                         |
| ---------- | ------ | ------------------------------------------------------------ |
| M          | 8      | 整数乘法与除法指令                                           |
| A          | 11     | 存储器原子（ Atomic ）操作指令和Load -Reserved/Store- Conditional 指令 |
| F          | 26     | 单精度(3 2 比特） 浮点指令                                   |
| D          | 26     | 双精度（ 64 比特）浮点指令，必须支持F 扩展指令               |
|            | 46     | 压缩指令，指令长度为16 位                                    |

- 特定组合：IMAFD => “通用”G
- 可选“压缩”指令子集C，指令编码长度16 bit；非压缩指令长度32 bit



### 可配置的通用寄存器组

- 支持32 位或者64 位的架构， 32 位架构由RV32 表示，其每个通用寄存器的宽度为32 比特：“ 位架构由RV64 表示， 其每个通用寄存器的宽度为64 比特
- I架构：32个通用整数寄存器，其中整数寄存器0被预留为常数0 ，其他的31 个为普通的通用整数寄存器



### 规整的指令编码

- 指令集编码非常规整，指令所需的通用寄存器的索引(index)都被放在固定的位置



### 简洁的存储器访问指令

- 使用专用的存储器读（ Load ）指令和存储器写（ Store ）指令访问存储器（ Memory〉，其他的普通指令无法访问存储器
- 存储器读和存储器写指令支持一个字节（ 8 位〉、半字(16 位） 、单字（ 32 位〉为单位的存储器读写操作
- 推荐使用地址对齐的存储器读写操作，但是也支持地址非对齐的存储器操作RISC-V 架构
- 仅支持小端格式
- 存储器读和存储器写指令不支持地址自增自减的模式
- 采用松散存储器模型（ Relaxed Memory Model ） ， 松散存储器模型对于访问不同地址的存储器读写指令的执行顺序不作要求，除非使用明确的存储器屏障指令加以屏蔽



### 高效的分支跳转指令

- 两条无条件跳转指令（Unconditional Jump ），即jal 指令与jalr 指令
- 6条带条件跳转指令（ Conditional Branch ），此类指令将比较与跳转两个操作放在一条指令里完成
- 采用默认的静态分支预测机制，即如果是向后跳转的条件跳转指令，则预测为“跳”；如果是向前跳转的条件跳转指令，则预测为“不跳”



### 简洁的子程序调用

- 放弃使用“一次读多个寄存器指令”和“一次写多个寄存器指令”



### 明确的 RAS 依据

- 如果使用jal 指令且目标寄存器索引值rd 等于xl 或者x5 ，则属于需要进行RAS 压栈
- 如果使用j alr 指令，则按照使用的寄存器值（rsl 和rd ）的不同，明确规定了相应的RAS 压校或者出技行为



### 无条件码执行

- 对于任何的条件判断都使用普通的带条件分支跳转指令



### 无分支延迟槽

- 现代的高性能处理器的分支预测算法精度己经非常高，可以有强大的分支预测电路保证CPU能够准确预测跳转执行达到高性能



### 无零开销硬件循环

- 零开销硬件循环指令大幅地增加了硬件设计的复杂度，RISC-V中无此类指令



### 简洁的运算指令

- 对任何的运算指令错误（包括整数与浮点指令〉均不产生异常，而是产生某个特殊的默认值，同时设置某些状态寄存器的状态位
- 整数指令都是两操作数



### 优雅的压缩指令子集

- 为了满足某些对于代码体积要求较高的场景，定义了一种可选的压缩（ Compressed ）指令子集
- 16 位指令的压缩策略是将一部分普通最常用的32 位指令中的信息进行压缩重排得到，因此每一条16 位长的指令都能找到其一一对应的原始32 位指令



### 特权模式

- Machine Mode ：机器模式，简称M Mode （必选）
- Supervisor Mode ：监督模式，简称S Mode （可选）
- User Mode ：用户模式，简称U Mode （可选）



### CSR寄存器

- 定义了一些控制和状态寄存器（ Control and Status Register， CSR ），用于配置或记录一些运行的状态
- CSR 寄存器是处理器核内部的寄存器，使用自己的地址编码空间和存储器寻址的地址区间完全无关系
- CSR 寄存器的访问采用专用的CSR 指令



### 中断和异常

- 定义了一套相对简单基本的中断和异常机制，但是也允许用户对其进行定制和扩展



### 指令的数量少

- 一套指令集支持所有架构。基本指令子集仅40 余条指令，以此为共有基础， 加上其他常用模块子集指令总指令数也仅几十条